!function(t,e){t.fn.MyOrdbok=function(n){function i(e){r[e[0]]&&t.isFunction(r[e[0]])?r[e[0]]():r[e[0]]&&t.isFunction(r[e[0]][e[1]])?r[e[0]][e[1]]():r[e[0]]&&t.isFunction(r[e[0]][0])&&r[e[0]][0]()}var a={tag:{f:"<form>",p:"<p>",i:"<input>",l:"<label>",t:"<textarea>",d:"<div>",u:"<ul>",o:"<ol>",li:"<li>",a:"<a>",s:"<span>",e:"<em>",strong:"<strong>",bold:"<b>",img:"<img>",h4:"<h4>"},name:{form:'form[name="*"]',input:'input[name="*"]',button:'button[name="*"]',meta:'meta[name="*"]',tag:"<*>",class:".",id:"#"},check:function(t){return void 0!==t?t:""},data:{link:function(e){t.each(e,function(e,n){a[n]=t('link[rel="*"]'.replace("*",n)).attr("href")})},meta:function(e){t.each(e,function(e,n){a[n]=t(a.name.meta.replace("*",n)).attr("content")})}},Form:function(t){return this.name.form.replace("*",t)},Input:function(t){return this.name.input.replace("*",t)},Tag:function(t){return this.name.tag.replace("*",t)},Class:function(t){return this.name.class+t},Id:function(t){return this.name.id+t},Char:function(e){return t.map(e,function(e){return t.isNumeric(e)?String.fromCharCode(e):e}).join("")},Url:function(e){return t.map(e,function(e){return t.isPlainObject(e)?"?"+t.param(e):e?"/"==e.slice(-1)?e.slice(0,-1):e:void 0}).join("/").replace("/?","?")},Trim:function(t){var e=/[^a-zA-Z0-9 ]/g;return t.match(e)&&(t=t.replace(e,"")),t.replace(/ /g,"")},store:{s:function(t,e,n){var i;if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i="; expires="+a.toGMTString()}document.cookie=escape(t)+"="+escape(e)+i+"; path=/"},g:function(t){for(var e=escape(t)+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return unescape(a.substring(e.length,a.length))}return null},r:function(t){this.s(t,"",-1)}},html:function(e,n,i){return t.each(n,function(n,s){var r=function(e,n,i){if(e){if(e.t)if(e.l)if(e.d)s=e.d;else var s=null;else n.append(t(a.tag(e.t),e.d));if(e.l&&e.l.length){var o=t(a.tag(e.t),s);for(index in e.l)r(e.l[index],o);n[i||"append"](o)}}};r(s,e,i)}),e},serializeObject:function(e){var n={};return t.each(e.serializeArray(),function(t,e){n[e.name]=e.value}),n},serializeJSON:function(e){var n={};return t.each(e.serializeArray(),function(){void 0!==n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n}};a.data.link(["api"]);var s="ontouchstart"in e.documentElement?"touchend":"click",r={suggest:{form:"search",field:"q",button:"submit",classIn:"in",className:"selected",listCurrent:-1,listTotal:0,delay:0,result:"#suggest",ready:function(){var e=this;e.form=t(a.Form(e.form)),e.form.length&&(e.field=e.form.find(a.Input(e.field)).attr("autocomplete","off").focus().select(),e.result=t(e.result),e.field.focusin(function(){e.form.addClass(e.classIn)}).focusout(function(){setTimeout(function(){e.clear()},200)}).keyup(function(n){var i=n||window.event,a=t(this).val();e.form.addClass(e.classIn),1!=e.arrows(i.keyCode,i.ctrlKey||i.metaKey)&&setTimeout(function(){e.listener(a)},e.delay)}))},clear:function(){this.result.empty(),this.form.removeClass(this.classIn)},listener:function(e){var n=this,i=n.field.val();""!=i&&e==i&&t.getJSON(a.Url([a.api,"suggestion"]),{q:i},function(e){n.listTotal=e.length,n.listTotal>0?(n.result.empty(),t.each(e,function(e,a){t("<p>",{title:a,html:a.replace(new RegExp(i,"i"),"<b>$&</b>")}).appendTo(n.result).mousemove(function(){n.add(this)})})):n.clear()})},arrows:function(e,n){var i=this;return t.inArray(e,[40,38,13])>=0?(38==e?i.listCurrent<=0?i.listCurrent=i.listTotal-1:i.listCurrent--:i.listCurrent>=i.listTotal-1?i.listCurrent=0:i.listCurrent++,i.result.children().each(function(t){t==i.listCurrent&&i.add(this)}),!0):t.inArray(e,[13,37,39,16,17,116])>=0||(!!(n&&t.inArray(e,[67])>=0)||(27!=e?13!=e&&(i.listCurrent=-1,!1):void 0))},add:function(e){var n=this,i=t(e);n.field.val(i.attr("title")),i.addClass(n.className).siblings().removeClass(),n.listCurrent=i.index(),i.click(function(){n.form.submit()})}},toggle:{menu:function(){t("ul.menu li[data-toggle]").on(s,function(){var e=t(this),n=e.data("toggle"),i=e.parent().next();e.addClass("active").siblings().removeClass("active"),i.is(":hidden")&&i.fadeIn("fast"),i.children(a.Class(n)).fadeToggle("fast",function(){t(this).is(":hidden")&&(i.fadeOut("fast"),e.removeClass("active"))}).siblings().fadeOut("fast")})},panel:function(){var n=t("body>div"),i=r.x,a=function(){i.removeClass("active").next().removeAttr("style").hide(),n.removeAttr("style")};i.hasClass("active")?a():(i.next().show().animate({width:"250px",height:"100%"}),i.next().hasClass("page")?n.animate({left:"+=250px"}):n.animate({right:"+=250px"}),n.css({width:"100%",position:"fixed"}),i.addClass("active"));var o=function(n){t(n.target).closest(i.next()).length||(a(),t(e).off(s,o))};t(e).on(s,o)}},word:{help:function(){this.form(r.x.data("word")).appendTo(r.x)},suggest:function(){r.x.parent().replaceWith(this.form(r.x.data("word")))},form:function(e){return t("<form>",{method:"POST"}).append(t("<div>").append(t("<input>",{type:"text",name:"word",value:e})),t("<div>").append(t("<span>").html("Meaning"),t("<textarea>",{name:"mean"})),t("<div>").append(t("<span>").html("Example"),t("<textarea>",{name:"exam"})),t("<p>").html(""),t("<div>",{class:"submit"}).append(t("<input>",{type:"submit",name:"submit",value:"Post"}),t("<input>",{type:"reset",value:"Reset"}))).on("submit",this.submit)},submit:function(e){e.preventDefault();var n=t(this),i=n.children("p");i.html("...a moment please").removeClass();t.post(a.Url([a.api,"post"]),a.serializeObject(t(this)),function(){}).done(function(t){i.html(t.msg).addClass(t.status),"done"==t.status&&n.children("div").hide()}).fail(function(t,e,n){i.html(n).addClass("fail")}).always(function(){})}},admin:{edit:function(){r.x.children().length?r.x.children().toggle():r.x.append(t("<span>",{class:"icon-tag"}).on(s,function(e){r.admin.Id=t(this).parent().attr("id"),r.admin.Id&&r.admin.editPanel(),e.preventDefault(),e.stopPropagation()}))},editContainer:function(){var e=t("body").children("div.editor");return e.length||(e=t("<div>",{class:"editor"}),t("body").append(e.append(t("<p>",{class:"animate-spin icon-loading"})))),e},editPanel:function(){var n=t("body").children("div.primary"),i=this.editContainer(),o=function(){i.removeAttr("style").hide(),n.removeAttr("style")},l=function(){if(i.fadeIn("fast"),t(e).width()<=736){n.css({width:"100%",position:"fixed"}).animate({right:"+=300px"});var a=function(n){t(n.target).closest(i).length||(o(),t(e).off(s,a))};t(e).on(s,a)}else n.css("margin-right","300px")};i.find(a.Form(this.Id)).length?i.is(":visible")?o():l():(i.addClass("wait"),t.ajax({type:"POST",url:a.Url([a.api,"editor"]),data:{q:this.Id},dataType:"json"}).done(function(t){i.append(r.admin.editForm(t))}).fail(function(t,e,n){console.log(e)}).always(function(t,e,n){i.removeClass("wait")}),l())},editForm:function(e){return t("<form>",{method:"POST",name:e.rows.id,id:"update"}).append(t("<div>").append(t("<input>",{type:"text",name:"word",value:e.rows.word})),t("<div>").append(t("<span>").html("Meaning"),t("<textarea>",{name:"sense"}).html(e.rows.sense)),t("<div>").append(t("<span>").html("Example"),t("<textarea>",{name:"exam"}).html(e.rows.exam)),t("<div>").append(t("<span>").html("seq"),t("<input>",{type:"text",name:"seq",value:e.rows.seq})),t("<div>").append(t("<select>",{name:"tid"}).html(this.editFormSelect(e.grammar,e.rows.tid))),t("<p>").html(""),t("<div>",{class:"submit"}).append(t("<input>",{type:"hidden",name:"id",value:e.rows.id}),t("<button>",{type:"submit",id:"update",text:"Update"}),t("<button>",{type:"submit",id:"insert",text:"Insert"}),t("<button>",{type:"submit",id:"delete",text:"Delete"}))).on("submit",this.editPost)},editFormSelect:function(e,n){return t.map(e,function(e,i){var a={value:i,text:e};return i==n&&(a.selected="selected"),t("<option>",a)})},editPost:function(n){n.preventDefault();var i=t("body").children("div.editor").addClass("wait"),s=t(this),r=s.children("p"),o=t(e.activeElement).attr("id")||s.attr("id");t.ajax({type:"POST",url:a.Url([a.api,"editor",o]),data:a.serializeObject(s),dataType:"json"}).done(function(t){console.log(t),t.error?r.html(t.msg):r.html("done")}).fail(function(t,e,n){console.log(e)}).always(function(){i.removeClass("wait")})},importMsgRset:function(){r.x.parents().parents().children().find(".msg").empty()},import:function(){this.msgContainer=r.x.parents().parents().children().find(".msg"),r.x.data("task")?this.importPost(r.x.removeClass("done error")):(r.x.html("Wait"),this.importNext(r.x.parent().children().removeClass("done working error"),0))},importNext:function(e,n){t(e[n]).data("task")?this.importPost(t(e[n])).promise().then(function(){e.length>=n?r.admin.importNext(e,n+1):r.x.html("Done")}):e.length>=n?r.admin.importNext(e,n+1):r.x.html("Done")},importPost:function(e){return t.ajax({type:"GET",url:a.Url([a.api,"import"]),data:{q:e.data("task")},dataType:"json",beforeSend:function(t){e.addClass("working")}}).done(function(n){n.error?(e.addClass("error"),r.admin.msgContainer.append(t("<p>",{class:e.data("task"),text:n.msg}))):e.addClass("done")}).fail(function(t,n,i){e.addClass("error")}).always(function(t,n,i){e.removeClass("working")})}},speech:function(){var t=e.createElement("audio");t.src=a.Url([a.api,"speech",{q:r.x.parent().text(),l:r.c[1]}]),r.x.addClass("playing"),t.load(),t.play(),t.addEventListener("ended",function(){r.x.removeClass("playing")})},click:function(){t(e).on(s,a.Class("zA"),function(e){var n=t(this);r.x=n,r.c=n.attr("class").split(" "),i(r.c),e.preventDefault(),e.stopPropagation()})},auto:function(){t(a.Class("zO")).each(function(){var e=t(this);r.x=e,r.c=e.attr("class").split(" "),i(r.c)})},img:{set:function(){}}};t.each(n,function(t,e){i(e.split(" "))})}}(jQuery,document);